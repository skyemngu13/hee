repeat 
    wait() 
until game:IsLoaded() and game.Players.LocalPlayer and 
      game.Workspace:FindFirstChild("__Extra") and 
      game.Workspace:FindFirstChild("__Main")

local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/jensonhirst/Orion/main/source"))()

local Window = OrionLib:MakeWindow({
    Name = "Pá»‹a Hub - Pá»‹a xÃ o me",  -- ThÃªm pháº§n text "Pá»‹a xÃ o me" phÃ­a trÆ°á»›c
    HidePremium = false,
    SaveConfig = false,
    ConfigFolder = "AutoHub"
})

local settingsFile = "piahub.json"
local HttpService = game:GetService("HttpService")

-- Äá»c settings
local settings = {}
pcall(function()
    if isfile(settingsFile) then
        settings = HttpService:JSONDecode(readfile(settingsFile))
    end
end)

-- LÆ°u settings
local function saveSettings()
    writefile(settingsFile, HttpService:JSONEncode(settings))
end

local InfoTab = Window:MakeTab({
    Name = "Info",
    Icon = "rbxassetid://83969479610474",
    PremiumOnly = false
})

-- ThÃ´ng bÃ¡o cáº­p nháº­t
InfoTab:AddParagraph("ğŸ› ï¸ Cáº­p nháº­t má»›i nháº¥t", [[
ğŸ“Œ - Version: v1.1
ğŸ†• + ThÃªm Auto Join Castle
ğŸ”§ + Cáº£i thiá»‡n hiá»‡u xuáº¥t tÃ­nh nÄƒng
ğŸ’¡ + LÆ°u setting khi telepoint
âš”ï¸ + Arise Ä‘ang cÃ³ "Jinwoo"-"Pucci"-"Denji"
â›©ï¸ + Check double "bÃº sjw N ğŸ¤‘"
ğŸ‘‰ + Fast auto click(test)
ğŸ‘‰ + Auto load script
âœ…ï¸ - Anti afk Ä‘Ã£ Ä‘Æ°á»£c báº­t
ğŸ‘‰ + Auto Attack
ğŸ”§ - fix farm mori nhÆ°ng váº«n dÃ¹ng tween
]])

local MainTab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://124598949660449",
    PremiumOnly = false
})

local toggleList = {
    {
        Name = "Auto Bypass",
        Key = "AutoBypass",
        Script = "https://raw.githubusercontent.com/skyemngu13/hee/refs/heads/main/bypass"
    },
    {
        Name = "Auto Join Castle",  -- ğŸ‘ˆ Toggle má»›i
        Key = "AutoJoinCastle",
        Script = "https://raw.githubusercontent.com/skyemngu13/hee/refs/heads/main/castle"
    },
    {
        Name = "Auto Destroy", 
        Key = "AutoDestroy",
        Script = "https://raw.githubusercontent.com/skyemngu13/hee/refs/heads/main/destroy"
    }
}

-- Táº¡o toggle
for _, t in ipairs(toggleList) do
    settings[t.Key] = settings[t.Key] or false

    MainTab:AddToggle({
        Name = t.Name,
        Default = settings[t.Key],
        Callback = function(val)
            settings[t.Key] = val
            saveSettings()

            if val then
                -- Cháº¡y sau 1 frame, trÃ¡nh crash UI
                task.spawn(function()
                    pcall(function()
                        loadstring(game:HttpGet(t.Script))()
                    end)
                end)
            end
        end
    })
end

MainTab:AddLabel("ğŸ•³ï¸ Auto Farm Dungeon")

local autodungeon = settings["Autofarmdungeon"] or false
local dungeonDelay = settings["DungeonDelay"] or 0.5

MainTab:AddToggle({
    Name = "Auto Farm Dungeon",
    Default = autodungeon,
    Callback = function(val)
        autodungeon = val
        settings["Autofarmdungeon"] = val --he
        saveSettings()  --  LÆ°u láº¡i
    end
})


MainTab:AddTextbox({
    Name = "Delay giáº¿t quÃ¡i Dungeon (giÃ¢y)",
    Default = tostring(dungeonDelay),
    TextDisappear = false,
    Callback = function(val)
        local number = tonumber(val)
        if number then
            dungeonDelay = number
            settings["DungeonDelay"] = number  -- <== LÆ°u vÃ o settings
            saveSettings()                     -- <== Gá»i hÃ m lÆ°u
        end
    end
})

-- Luá»“ng xá»­ lÃ½ Auto Farm Dungeon
task.spawn(function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local rootPart = character:WaitForChild("HumanoidRootPart")
    local enemies = workspace:WaitForChild("__Main"):WaitForChild("__Enemies"):WaitForChild("Server")

    -- TÃ¬m mob gáº§n nháº¥t (HP > 0, Scale = 2)
    local function findNearestMob()
    local priorityMob, fallbackMob = nil, nil
    local minDistPriority, minDistFallback = math.huge, math.huge

    for _, mob in pairs(enemies:GetChildren()) do
        if mob:IsA("Part") then
            local hp = mob:GetAttribute("HP")
            local scale = mob:GetAttribute("Scale")
            if hp and hp > 0 then
                local dist = (mob.Position - rootPart.Position).Magnitude
                if scale and scale >= 2 and dist < minDistPriority then
                    minDistPriority = dist
                    priorityMob = mob
                elseif scale == 1 and dist < minDistFallback then
                    minDistFallback = dist
                    fallbackMob = mob
                end
            end
        end
    end

    return priorityMob or fallbackMob
end

    -- Teleport gáº§n mob
    local function teleportNearMob(mob)
        local direction = (rootPart.Position - mob.Position).Unit
        local offset = direction * 8 + Vector3.new(0, 3, 0)
        local targetPos = mob.Position + offset
        rootPart.CFrame = CFrame.new(targetPos, mob.Position)
    end

    -- Xá»­ lÃ½ mob
    local function handleMob(mob)
        teleportNearMob(mob)
        repeat task.wait() until not mob:IsDescendantOf(workspace) or (mob:GetAttribute("HP") or 0) <= 0
        task.wait(dungeonDelay)
    end

    -- VÃ²ng láº·p chÃ­nh
    while true do
        if autodungeon then
            local mob = findNearestMob()
            if mob then
                handleMob(mob)
            else
                task.wait(0.2)
            end
        else
            task.wait(0.2)
        end
    end
end)

MainTab:AddLabel("ğŸŒ¾ Auto Farm Mori")

local autoMori = settings["AutoFarmMori"] or false
local delayAfterKill = settings["DelayAfterKill"] or 0.5

-- Toggle Auto Farm Mori
MainTab:AddToggle({
    Name = "Auto Farm Mori",
    Default = autoMori,
    Callback = function(val)
        autoMori = val
        settings["AutoFarmMori"] = val --he
        saveSettings()  --  LÆ°u láº¡i
    end
})

-- Textbox Ä‘á»ƒ chá»‰nh delay sau khi giáº¿t mob
MainTab:AddTextbox({
    Name = "Delay sau khi giáº¿t mob (giÃ¢y)",
    Default = tostring(delayAfterKill),
    TextDisappear = false,
    Callback = function(val)
        local number = tonumber(val)
        if number then
            delayAfterKill = number
            settings["DelayAfterKill"] = number  -- <== LÆ°u vÃ o settings
            saveSettings()                       -- <== Gá»i hÃ m lÆ°u
        end
    end
})

-- Luá»“ng xá»­ lÃ½ Auto Farm Mori
task.spawn(function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local rootPart = character:WaitForChild("HumanoidRootPart")
    local enemies = workspace.__Main.__Enemies.Server

    local mapId = "7"
    local targetMap = enemies:FindFirstChild(mapId)
    if not targetMap then return end

    local function findNearestMob()
        local nearest, minDist = nil, math.huge
        for _, mob in pairs(targetMap:GetChildren()) do
            local hp = mob:GetAttribute("HP")
            local scale = mob:GetAttribute("Scale")
            if hp and hp > 0 and scale == 2 then
                local dist = (mob.Position - rootPart.Position).Magnitude
                if dist < minDist then
                    minDist, nearest = dist, mob
                end
            end
        end
        return nearest
    end

    local function teleportNearMob(mob)
        local direction = (rootPart.Position - mob.Position).Unit
        local offset = direction * 8 + Vector3.new(0, 3, 0)
        local targetPos = mob.Position + offset
        rootPart.CFrame = CFrame.new(targetPos, mob.Position)
    end

    local function handleMob(mob)
        teleportNearMob(mob)
        repeat task.wait() until not mob:IsDescendantOf(workspace) or (mob:GetAttribute("HP") or 0) <= 0
        task.wait(delayAfterKill)
    end

    while true do
        if autoMori then
            local mob = findNearestMob()
            if mob then
                handleMob(mob)
            else
                task.wait(0.5)
            end
        else
            task.wait(0.2)
        end
    end
end)

-- Táº¡o Tab Misc vá»›i Toggle AutoClick (Tab nÃ y sáº½ lÃ  tab thá»© 3)
local MiscTab = Window:MakeTab({
    Name = "Misc",
    Icon = "rbxassetid://95758233681936",
    PremiumOnly = false
})

local autoClicking = false  -- Biáº¿n tráº¡ng thÃ¡i AutoClick

MiscTab:AddToggle({
    Name = "AutoClick",  -- Toggle má»›i
    Default = settings["AutoClick"] or false,
    Callback = function(val)
        settings["AutoClick"] = val
        saveSettings()

        if val then
            -- Báº¯t Ä‘áº§u AutoClick khi toggle báº­t
            autoClicking = true
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Player = game:GetService("Players").LocalPlayer
            local SharedModules = ReplicatedStorage.SharedModules

            require(SharedModules.Others.GuiFunctions)
            local WeaponsModule = require(SharedModules.WeaponsModule)

            -- Chá» player load xong
            repeat task.wait(1) until Player:GetAttribute("Loaded") == true

            -- Báº¯t Ä‘áº§u vÃ²ng láº·p AutoClick
            task.spawn(function()
                while autoClicking do
                    task.wait(0.1)

                    -- Náº¿u khÃ´ng cÃ³ gamepass AutoClicker thÃ¬ delay lÃ¢u hÆ¡n
                    if Player.leaderstats:FindFirstChild("Passes") and Player.leaderstats.Passes:GetAttribute("AutoClicker") ~= true then
                        task.wait(0.2)
                    end

                    -- Náº¿u bá»‹ táº¯t thÃ¬ tá»± báº­t láº¡i
                    if Player:GetAttribute("AutoClick") ~= true then
                        Player:SetAttribute("AutoClick", true)
                    end

                    -- Gá»i Click
                    WeaponsModule.Click({
                        ["KeyCode"] = Enum.KeyCode.ButtonX
                    }, false, nil, true)
                end
            end)
        else
            -- Dá»«ng AutoClick khi toggle táº¯t
            autoClicking = false
        end
    end
})

MiscTab:AddToggle({
    Name = "Auto Attack",  -- Toggle Auto Attack
    Default = settings["AutoAttack"] or false,
    Callback = function(val)
        settings["AutoAttack"] = val
        saveSettings()

        if val then
            -- Cháº¡y script Auto Attack tá»« URL khi toggle báº­t
            task.spawn(function()
                pcall(function()
                    loadstring(game:HttpGet("https://raw.githubusercontent.com/skyemngu13/hee/refs/heads/main/auto%20attack"))()
                end)
            end)
        else
            -- Táº¯t Auto Attack khi toggle táº¯t
            -- Báº¡n cÃ³ thá»ƒ thÃªm logic Ä‘á»ƒ dá»«ng script Auto Attack náº¿u cáº§n
        end
    end
})

MiscTab:AddToggle({
    Name = "Auto Load Script",
    Default = settings["AutoLoadScript"] or false,
    Callback = function(val)
        settings["AutoLoadScript"] = val
        saveSettings()

        if val then
            queue_on_teleport([[
                loadstring(game:HttpGet('https://raw.githubusercontent.com/Baylac2006/memaybeo/refs/heads/main/memaybeo'))()
            ]])
        end
    end
})

-- Sau khi UI xong â†’ cháº¡y cÃ¡c script Ä‘Ã£ báº­t
task.spawn(function()
    task.wait(1) -- Ä‘áº£m báº£o UI váº½ xong
    for _, t in ipairs(toggleList) do
        if settings[t.Key] then
            pcall(function()
                loadstring(game:HttpGet(t.Script))()
            end)
        end
    end
end)

-- Anti-AFK Script (Auto Execute Version)
local vu = game:GetService("VirtualUser")
game:GetService("Players").LocalPlayer.Idled:Connect(function()
    vu:CaptureController()
    vu:ClickButton2(Vector2.new(0,0))
end)

-- Bypass Anti-Teleport (LuÃ´n cháº¡y song song nhÆ° Anti-AFK)
task.spawn(function()
    local replicated = game:GetService("ReplicatedStorage")
    local extraFunctions = require(replicated:WaitForChild("SharedModules"):WaitForChild("ExtraFunctions"))

    if not getgenv()._original_GetPlayerSpeed then
        getgenv()._original_GetPlayerSpeed = extraFunctions.GetPlayerSpeed

        extraFunctions.GetPlayerSpeed = function(player)
            return 999999
        end

        warn("âœ… ÄÃ£ bypass anti teleport")
    end
end)
