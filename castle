local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- ID của lobby
local lobbyPlaceId = 87039211657390

-- Gửi remote JoinCastle
local function joinCastle()
    local args = {
        [1] = {
            [1] = {
                ["Event"] = "JoinCastle"
            },
            [2] = "\n"
        }
    }
    ReplicatedStorage:WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent"):FireServer(unpack(args))
end

-- Kiểm tra và xử lý khi đang trong dungeon
spawn(function()
    while true do
        -- Đợi nhân vật xuất hiện để chắc chắn GUI đã load
        if LocalPlayer.Character then
            local success, err = pcall(function()
                local roomText = LocalPlayer:WaitForChild("PlayerGui")
                    :WaitForChild("Hud")
                    :WaitForChild("UpContanier")
                    :WaitForChild("Room").Text

                -- Nếu text là "Floor: 31/100"
                if tostring(roomText):find("Floor: 31/100") then
                    wait(3)
                    TeleportService:Teleport(lobbyPlaceId)
                end
            end)
        end

        wait(2) -- Kiểm tra thường xuyên hơn trong dungeon
    end
end)

-- Kiểm tra thời gian mỗi phút để gửi JoinCastle
spawn(function()
    while true do
        local currentMinute = os.date("*t").min

        if currentMinute >= 45 and currentMinute <= 58 then
            joinCastle()
        end

        wait(60)
    end
end)
