local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- PlaceId của lobby và dungeon (castle)
local lobbyPlaceId = 87039211657390  -- <-- thay bằng PlaceId của lobby
local dungeonPlaceId = 128336380114944  -- PlaceId của dungeon (castle)

-- Biến theo dõi trạng thái
local isInDungeon = false

-- Sự kiện khi nhân vật mới được thêm (sau teleport)
LocalPlayer.CharacterAdded:Connect(function()
    -- Kiểm tra nếu player đang ở trong dungeon
    if game.PlaceId == dungeonPlaceId then
        isInDungeon = true
    else
        isInDungeon = false
    end
end)

-- Vòng lặp kiểm tra thời gian thực
spawn(function()
    while true do
        -- Lấy thời gian thực hiện tại
        local currentTime = os.date("*t")
        local currentMinute = currentTime.min
        local currentHour = currentTime.hour

        -- Nếu đang ở dungeon, đợi cho đến khi vào giờ mới (xx:00)
        if isInDungeon then
            -- Nếu hiện tại là phút 45 trở lên, nhưng chưa đến phút 58, đợi cho đến khi qua phút 58
            if currentMinute >= 45 and currentMinute <= 58 then
                -- Đợi đến giờ tiếp theo (xx:00)
                while os.date("*t").min ~= 0 do
                    wait(1)  -- Kiểm tra mỗi giây để đợi tới giờ 00
                end
            end
        else
            -- Nếu không ở dungeon, kiểm tra giờ thực để teleport
            if currentMinute >= 45 and currentMinute <= 58 then
                -- Teleport vào castle (nếu đang ở lobby)
                TeleportService:Teleport(dungeonPlaceId, LocalPlayer)
                
                -- Sau khi teleport vào castle, gửi remote join castle
                local args = {
                    [1] = {
                        [1] = {
                            ["Event"] = "JoinCastle"
                        },
                        [2] = "\n"
                    }
                }
                game:GetService("ReplicatedStorage"):WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent"):FireServer(unpack(args))
            end
        end
        
        wait(60)  -- Kiểm tra mỗi phút
    end
end)
