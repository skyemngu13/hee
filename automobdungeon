local punchCooldown = 0.5 -- thời gian giữa 2 lần punch
local lastPunchTime = 0

local function moveToAndPunch(mob)
    if not mob or not mob:IsDescendantOf(workspace) then return end
    isBusy = true

    local uuid = mob:GetAttribute("UUID") or mob.Name
    local distance = (mob.Position - rootPart.Position).Magnitude
    local tweenTime = distance / speed

    local finished = false
    local tween = TweenService:Create(rootPart, TweenInfo.new(tweenTime, Enum.EasingStyle.Linear), {CFrame = mob.CFrame})
    tween.Completed:Connect(function()
        finished = true
    end)
    tween:Play()

    local timeout = 3
    local elapsed = 0
    while not finished and elapsed < timeout do
        if not mob or not mob.Parent then break end
        elapsed += task.wait()
    end

    tween:Cancel()
    task.wait(0.5)

    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not mob or not mob.Parent then
            connection:Disconnect()
            connection = nil
            isBusy = false
            return
        end

        local hp = mob:GetAttribute("HP")
        if not hp or hp <= 0 then
            connection:Disconnect()
            connection = nil

            task.spawn(function()
                if mob:GetAttribute("Model") == "JinWoo" or mob:GetAttribute("Model") == "Pucci" or mob:GetAttribute("Model") == "Denji" then
                    ariseMob(uuid)
                else
                    destroyMob(uuid)
                end
            end)

            isBusy = false
            return
        end

        -- Kiểm tra cooldown
        if tick() - lastPunchTime >= punchCooldown then
            punchMob(uuid)
            lastPunchTime = tick()
        end
    end)
end
