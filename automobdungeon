-- Move to the mob and monitor HP, but DO NOT punch
local function moveToMob(mob)
    if tween then
        tween:Cancel()
    end

    local uuid = mob:GetAttribute("UUID") or mob.Name
    local distance = (mob.Position - rootPart.Position).Magnitude
    local tweenTime = distance / speed

    -- Tween đến quái
    tween = TweenService:Create(rootPart, TweenInfo.new(tweenTime, Enum.EasingStyle.Linear), {CFrame = mob.CFrame})
    tween:Play()

    -- Theo dõi HP của quái trong khi di chuyển
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not mob or not mob.Parent then
            connection:Disconnect()
            reachedMob = nil
            return
        end

        local hp = mob:GetAttribute("HP")
        if not hp or hp <= 0 then
            connection:Disconnect()
            local model = mob:GetAttribute("Model")
            local scale = mob:GetAttribute("Scale") or 1

            if (model == "JinWoo" or model == "Pucci" or model == "Denji") and scale >= 2 then
                task.spawn(function()
                    ariseMob(uuid)
                end)
            else
                task.spawn(function()
                    destroyMob(uuid)
                end)
            end
            reachedMob = nil
        end
    end)

    -- Đợi tween xong và di chuyển tiếp đến mob khác ngay lập tức
    tween.Completed:Connect(function()
        if not reachedMob then
            reachedMob = mob
        end
    end)
end
